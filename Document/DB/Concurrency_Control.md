## 병행 제어(Concurrency Control)
>병행 제어란 다중 프로그램의 이점을 활용하여 동시에 여러개의 트랜잭션을 병행 수행할 때 실행되는 트랜잭션들이 <br>**데이터베이스의 일관성을 파괴하지 않도록 트랜잭션 간의 상호 작용을 제어하는 기술**
- 병행성이란 여러 개의 트랜잭션들이 **동시에 인터러빙(Interleaving) 하게 실행**되는 것을 의미 
    - 인터러빙(Interleaving): 트랜잭션들이 번갈아가며 조금씩 자신이 처리해야 할 일을 처리하는 것 
### 병행 제어의 목적
- 데이터베이스의 **공유를 최대화**한다.
- 시스템의 **활용도를 최대화**한다.
- 사용자에 대한 **응답 시간을 최소화**한다.
- **단위 시간당 트랜잭션 처리 건수를 최대화**한다.
- 데이터베이스의 **일관성을 유지**한다.
### 병행 제어의 필요성
>병행 제어 없이 트랜잭션들이 데이터베이스에 동시에 접근하도록 허용할 경우 다음과 같은 문제점이 발생

|문제점|의미|
|:------|:-------|
|갱신 분실<br>(Lost Update)|2개 이상의 트랜잭션이 같은 데이터를 공유하여 갱신할 때 갱신 결과의 일부가 없어지는 현상|
|모순성<BR>(Inconsistency)|- 복수의 사용자가 동시에 같은 데이터를 갱신할 떄 데이터베이스 내의<br> 데이터들이 상호 일치하지않아 모순된 결과가 발생하는 현상<br>- 불일치 분석(Inconsistent Analysis)이라고도 한다.|
|연쇄 복귀<br>(Cascading Rollback)|병행 수행되던 트랜잭션들 중 어느 하나에 문제가 생겨 Rollback 되는 경우<br> 다른 트랜잭션들도 함꼐 Rollback 되는 현상|

### 잠금(Lock)
>잠금이란 데이터베이스 관리에서 하나의 트랜잭션에 **사용되는 데이터를 다른 트랜잭션이 접근하지 못하게 하는 것을 의미** 
- 트랜잭션들은 어떤 데이터를 접근하기 전에 잠금을 요청하여 잠금을 허락받아야 한다. 
- 데이터를 갱신할 때는 반드시 **잠금(Lock) -> 실행(Execute) -> 해제(Unlock)** 의 규칙을 따라야 한다.
- 잠금단위
    - 병행 제어에서 한 번에 잠금할 수 있는 단위로 데이터베이스, 테이블, 레코드, 필드 등이 사용될 수 있다.
    - 잠금 단위가 크면 잠금 수가 작아 관리하기 쉽지만 공유성 수준이 낮아지고<br>잠금 단위가 작으면 잠금수가 많아 관리하기 복잡하지만 공유성 수준이 높아진다.
    ```
    <----- Locking Overhead는 감소하나 공유성이 낮아짐
            데이터베이스 -> 테이블 -> 레코드 -> 필드
           Locking Overhead는 증가하나 공유성이 높아짐 ----->
    ```
- **교착 상태(Dead Lock)**
    - 교착 상태란 어느 한 트랜잭션이 사용하기 위해 잠가 놓은 자원을 사용하기 위해 기다리므로 <br>모든 트랜잭션들이 실행을 전혀 진전시키지 못하고 **무한정 기다리는 상태**를 말함
- **공유 잠금(Shared-LocK)**
    - 트랜잭션 Ti가 데이터 X에 대하여 **공유 잠금을 걸면** 트랜잭션 Tj는 데이터 X에 대해 **읽기만 가능하고 기록은 불가능**
- **배타 잠금(Exclusive-Lock)**
    - 트랜잭션 Ti가 데이터 X에 대하여 **배타 잠금을 걸면** 트랜잭션 Tj는 데이터 X에 대해 **읽기나 기록 모두 불가능**

### 병행 제어 기법의 종류
- **2단계 잠금 규악(Two-Phase Lock Protocol) 기법**
    - 트랜잭션 스케줄의 직렬성을 보장하는 대표적인 잠금 기법
        - **트랜잭션 스케줄(Transaction Schedule)**
            - 트랜잭션의 연산들이 인터리빙하게 실행되는 것이 허용될 떄 **트랜잭션들의 개개 연산들이 실행되는 순서**를 의미
            - **직렬 스케줄**: 서로 다른 트랜잭션들의 연산 사이에 **인터리빙이 없는 스케줄**
            - **병렬 스케줄**: 서로 다른 트랜잭션들의 연산 사이에 **인터리빙이 있는 스케줄**
    - 모든 트랜잭션들이 잠금과 잠금 해제를 다음과 같이 2단계로 수행되도록 한다.
        - **확장(Grwoing) 단계** : 트랜잭션이 **잠금만 수행**할 수 있고 잠금 해제는 수행할 수 없는 단계
        - **축소(Shrinking) 단계** : 트랜잭션이 **잠금 해제만 수행**할 수 있고 잠금은 수행할 수 없는 단계
    - **스케줄의 직렬성을 보장한다는 장점**은 있지만 **교착 상태를 예방할 수는 없다는 단점**이있다.
- **타임 스탬프 순서(Time Stamp Ordering) 기법**
    - 각 트랜잭션을 실행할 때 부여하는 값
    - 트랜잭션들을 인터리빙하게 실행한 결과가 시간 스탬프 순서대로 트랜잭션들을 실행하는 **직렬스케줄의 실행 결과와 항상 동일다는 것을 보장**하는 기법
    - 직렬성 순서를 결정하기 위해 트랜잭션 간의 실행 순서를 미리 결정하는 기법들 중에서 가장 보편적인 방법
    - 읽거나 변경할 데이터에 대해 트랜잭션을 실행하기 전에 **타임 스탬프를 부여**하고 **타임 스탬프 순서에 따라 트랜잭션 작업을 수행**하도록 한다.
    - **교착 상태가 발생하지 않는다.**