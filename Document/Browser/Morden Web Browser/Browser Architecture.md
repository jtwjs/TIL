## 브라우저 아키텍처

> 브라우저를 만드는 방법에 대한 표준은 없다. 브라우저마다 접근방식이 완전히 다를 수 있음

### Chrome Browser Architecture

> Chrome은 탭마다 프로세스를 할당했다.
> <br>이제는 사이트(iframe에 있는 사이트 포함)마다 프로세스를 할당한다.

![브라우저 아키텍처](https://user-images.githubusercontent.com/60641307/97261421-26b21a00-1862-11eb-9ad2-5e132b3cd616.png)

- 제일 위에 있는 브라우저 프로세스는 애플리케이션의 각부분을 맡고있는 다른 프로세스를 조정한다.
- 렌더러 프로세스는 여러 개가 만들어져 각 탭마다 할당된다.(예전방식)
  - 탭마다 프로세스를 할당하는 방법을 `process per tab`
  - 사이트마다 프로세스를 할당하는 방법을 `process per site`

### Chrome의 각 프로세스

#### 브라우저 프로세스

- 애플리케이션의 "chrome" 부분을 제어
  - 소문자로 시작하는 "chrome"은 브라우저 이름이 아닌 브라우저 UI 영역을 의미하는 말
  - 주소 표시줄
  - 북마크 막대
  - 뒤로가기 앞으로가기 버튼 등
- 네트워크 요청이나 파일접근과 같이 눈에 보이지는 않지만 권한이 필요한 부분도 처리한다.

#### 렌더러 프로세스

- 탭 안에서 웹사이트가 표시되는 부분의 모든것을 제어한다.

#### 플러그인 프로세스

- 웹 사이트에서 사용하는 플러그인(ex: Flash)을 제어

#### GPU 프로세스

- GPU 작업을 다른 프로세스와 격리해서 처리한다.
- GPU는 여러 애플리케이션의 요청을 처리하고 같은 화면에 요청받은 내용을 그리기 떄문에 GPU 프로세스는 별도 프로세스로 분리되어 있다.

#### 브라우저 UI에서 각 프로세스가 담당하는 부분

![브라우저 UI](https://user-images.githubusercontent.com/60641307/97262172-af7d8580-1863-11eb-9e89-15d58519d263.png)

- 이 외에도 확장 프로그램(Extension)프로세스, 유틸리티 프로세스 등 더 많은 프로세스가 있다.

### 다중 프로세스 아키텍처가 Chrome에 주는 이점

- 각 탭은 독립적인 렌더러 프로세스에 의해 실행되기 때문에 한 탭이 응답하지 않더라도 다른 탭은 사용 가능하다.

  - 웹 페이지에서 처리할 작업이 많아 응답하지 못하는 경우
  - 웹 페이지를 담당하던 렌더러 프로세스의 실행이 중단된 경우

- 브라우저 프로세스와 렌더러 프로세스를 분리 했을때의 장점
  - 렌더러 프로세스가 웹 페이지를 그리는 도중 오류가 발생해 실행이 중단되더라도 브라우저 전체가 종료되지 않고 오류 페이지를 보여주는 정도로 문제를 처리할 수 있다.
- 브라우저의 작업을 여러 프로세스에 나눠서 처리하는 방법의 또다른 장점은 보안과 격리`(sandbox)`이다.
  - 운영체제를 통해 프로세스의 권한을 제한할 수 있어 브라우저는 특정 프로세스가 특정 기능을 사용할 수 없게 제한할수 있다.
- 프로세스는 전용 메모리 공간을 사용하기 때문에 공통 부분을 복사해서 가지고 있는 경우가 많다.
  - 서로 다른 프로세스는 메모리를 공유할수 없어 메모리 사용량이 더 많다.
    - 동일 프로세스의 스레드는 메모리 공유가능
  - Chrome은 메모리를 절약하기 위해서 실행할 수 있는 프로세스의 개수를 제한한다.
    - 프로세스의 개수가 한도에 다다르면 동일한 사이트를 열고 있는 여러 탭을 하나의 프로세스에서 처리

### Chrome의 서비스화

> Chrome은 브라우저의 각 부분을 서비스로 실행해 여러 프로세스로 쉽게 분할하거나 하나의 프로세스를 통합할수 있도록 아키텍처를 변경하고 있다.

- 성능이 좋은 하드웨어에서 Chrome이 실행중일 때는 각 서비스를 여러 프로세스로 분할해 안정성을 높임
- 리소스가 제한적인 장치에서 실행중일때는 서비스를 하나의 프로세스에서 실행해서 메모리 사용량을 줄이는 것이 기본 아이디어

### 프레임별로 실행되는 렌더러 프로세스 - 사이트 격리

> 사이트 격리(site isolation)는 Chrome에서 최근 도입된 기능으로, iframe의 사이트를 별도의 렌더러 프로세스에서 실행하는 것이다.

- 탭마다 렌더러 프로세스를 할당하는 모델에서는 iframe의 사이트가 같은 렌더러 프로세스에서 작동하기 떄문에 서로 다른 사이트간에 메모리가 공유될수 있는 문제점이 있다.

- 동일 출처 정책(same origin policy)은 웹 보안 모델의 핵심
  - 한사이트는 동의 없이 다른 사이트의 데이터에 접근할수 없어야 한다.
- 프로세스를 격리하는 것이 사이트를 격리하는 가장 효과적인 방법!
